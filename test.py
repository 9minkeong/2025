import streamlit as st
import time

# â”€â”€ í˜ì´ì§€ & ìŠ¤íƒ€ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(page_title="ğŸ’Š ì¦ìƒë³„ ì•½ ì¶”ì²œ (ìŠ¤í…í˜•)", page_icon="ğŸ’Š", layout="wide")
st.markdown("""
<style>
.stApp { background-color:#F0F8FF; }
.title { color:#4B0082; text-align:center; margin-top:4px; }
.step { background:#ffffff; border-radius:14px; padding:18px 20px; box-shadow:2px 2px 14px rgba(0,0,0,0.08); margin: 8px 0 18px; }
.card { background:#ffffff; border-radius:14px; padding:18px 20px; box-shadow:2px 2px 14px rgba(0,0,0,0.08); }
.highlight { color:#FF4500; font-weight:700; }
.hr { height:1px; background:linear-gradient(90deg,#fff, #c8c8ff, #fff); border:0; margin:14px 0; }
.emoji { font-size:48px; text-align:center; animation: pop .5s ease-in-out; }
@keyframes pop { 0%{transform:scale(0);} 50%{transform:scale(1.5);} 100%{transform:scale(1);} }
.small { color:#555; font-size:0.92rem; }
</style>
""", unsafe_allow_html=True)

st.markdown("<h1 class='title'>ğŸ’Š ì¦ìƒë³„ ì•½ ì¶”ì²œ Â· ìŠ¤í…í˜• ì„ íƒ</h1>", unsafe_allow_html=True)
st.write("âš ï¸ ì´ ì•±ì€ **ì˜ë£Œ ì°¸ê³ ìš©**ì…ë‹ˆë‹¤. ì •í™•í•œ ì§„ë‹¨/ì²˜ë°©ì€ ë°˜ë“œì‹œ **ì˜ì‚¬Â·ì•½ì‚¬**ì—ê²Œ ë°›ìœ¼ì„¸ìš”.")

# â”€â”€ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DB = {
    "ë‘í†µ": {
        "ì•½": "ì§„í†µì œ (ì˜ˆ: íƒ€ì´ë ˆë†€, ì´ë¶€í”„ë¡œíœ)",
        "ë¶€ì‘ìš©": "ì†ì“°ë¦¼, ìœ„ì¥ ì¥ì• , ë“œë¬¼ê²Œ ê°„ ê¸°ëŠ¥ ë¬¸ì œ",
        "ê´€ë¦¬ë²•": "ìˆ˜ë¶„ ì„­ì·¨, ëˆˆ íœ´ì‹, ê·œì¹™ì  ìˆ˜ë©´, ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬",
        "ë³µìš©ì‹œê°„": "ì¦ìƒ ë°œìƒ ì‹œ, í•˜ë£¨ ìµœëŒ€ 4íšŒ",
        "ì£¼ì˜ì‚¬í•­": "ê°„ ì§ˆí™˜ ë³‘ë ¥ ìˆìœ¼ë©´ ë³µìš© ì „ ìƒë‹´",
        "ë³µìš©íŒ": "ê°€ëŠ¥í•˜ë©´ ì‹í›„ ë³µìš©í•´ ìœ„ì¥ ë¶€ë‹´ ê°ì†Œ"
    },
    "ë°œì—´": {
        "ì•½": "í•´ì—´ì œ (ì˜ˆ: ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ, ì´ë¶€í”„ë¡œíœ)",
        "ë¶€ì‘ìš©": "ê°„ ì†ìƒ(ê³¼ëŸ‰), ìœ„ì¥ ì¥ì• , ë“œë¬¼ê²Œ ì•Œë ˆë¥´ê¸°",
        "ê´€ë¦¬ë²•": "ìˆ˜ë¶„ ë³´ì¶©, ê°€ë²¼ìš´ ë³µì¥, íœ´ì‹, ì²´ì˜¨ ëª¨ë‹ˆí„°ë§",
        "ë³µìš©ì‹œê°„": "6~8ì‹œê°„ ê°„ê²© í•„ìš” ì‹œ ë³µìš©",
        "ì£¼ì˜ì‚¬í•­": "ì–´ë¦°ì´/ë…¸ì¸/ê°„ ì§ˆí™˜ì ì£¼ì˜",
        "ë³µìš©íŒ": "í•˜ë£¨ ìµœëŒ€ ìš©ëŸ‰ ì¤€ìˆ˜, 38â„ƒ ì´ìƒì¼ ë•Œ í•„ìš” ì‹œ ì‚¬ìš©"
    },
    "ê¸°ì¹¨": {
        "ì•½": "ì§„í•´ì œÂ·ê±°ë‹´ì œ (ì˜ˆ: ë±ìŠ¤íŠ¸ë¡œë©”í† ë¥´íŒ, ì•”ë¸Œë¡ì†”)",
        "ë¶€ì‘ìš©": "ì¡¸ë¦¼, ì–´ì§€ëŸ¼, ì¥ê¸° ì‚¬ìš© ì‹œ ì˜ì¡´ ìš°ë ¤",
        "ê´€ë¦¬ë²•": "ë”°ëœ»í•œ ìŒë£Œ, ê°€ìŠµ, ì¶©ë¶„í•œ íœ´ì‹",
        "ë³µìš©ì‹œê°„": "í•˜ë£¨ 2~3íšŒ í•„ìš” ì‹œ",
        "ì£¼ì˜ì‚¬í•­": "ë§Œ 2ì„¸ ì´í•˜ ì‚¬ìš© ì œí•œ",
        "ë³µìš©íŒ": "ì•¼ê°„ ê¸°ì¹¨ ì‹¬í•˜ë©´ ì·¨ì¹¨ ì „ ì§„í•´ì œ"
    },
    "ì†ì“°ë¦¼": {
        "ì•½": "ì œì‚°ì œÂ·PPI (ì˜ˆ: ì˜¤ë©”í”„ë¼ì¡¸)",
        "ë¶€ì‘ìš©": "ì„¤ì‚¬Â·ë³€ë¹„, ì¥ê¸° ì‚¬ìš© ì‹œ ì˜ì–‘ í¡ìˆ˜ ì €í•˜",
        "ê´€ë¦¬ë²•": "ì¹´í˜ì¸Â·ê¸°ë¦„ì§„ ìŒì‹ í”¼í•˜ê¸°, ì‹í›„ ë°”ë¡œ ëˆ•ì§€ ì•Šê¸°",
        "ë³µìš©ì‹œê°„": "ì‹ì „ 30ë¶„ ë˜ëŠ” ì·¨ì¹¨ ì „",
        "ì£¼ì˜ì‚¬í•­": "ì¥ê¸° ë³µìš© ì „ ìƒë‹´ ê¶Œì¥",
        "ë³µìš©íŒ": "ì¦ìƒ ì‹¬í•˜ë©´ 1ì¼ 2íšŒ ë¶„ë³µ ê³ ë ¤(ì˜ì‚¬ ì§€ì‹œ ìš°ì„ )"
    },
    "ê·¼ìœ¡í†µ": {
        "ì•½": "ì§„í†µÂ·ì†Œì—¼ì œ (ì˜ˆ: ì´ë¶€í”„ë¡œíœ, ë‚˜í”„ë¡ì„¼), íŒŒìŠ¤",
        "ë¶€ì‘ìš©": "ìœ„ì¥ ì¥ì• , í”¼ë¶€ ìê·¹, ë“œë¬¼ê²Œ ì‹ ì¥ ì˜í–¥",
        "ê´€ë¦¬ë²•": "ìŠ¤íŠ¸ë ˆì¹­, ì˜¨ì°œì§ˆ, íœ´ì‹, ê³¼ì‚¬ìš© ë°©ì§€",
        "ë³µìš©ì‹œê°„": "ì¦ìƒ ì‹œ 1ì¼ ìµœëŒ€ 3~4íšŒ",
        "ì£¼ì˜ì‚¬í•­": "ì‹ ì¥/ìœ„ì¥ ì§ˆí™˜ì ì£¼ì˜",
        "ë³µìš©íŒ": "ë‹¨ê¸° ì§‘ì¤‘ ì‚¬ìš©, ì¥ê¸° ì—°ì† ë³µìš©ì€ í”¼í•˜ê¸°"
    }
}

# â”€â”€ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if "results" not in st.session_state:
    st.session_state.results = []

# â”€â”€ ìŠ¤í… 1: ì¦ìƒ ì„ íƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.container():
    st.markdown("<div class='step'>", unsafe_allow_html=True)
    st.subheader("â‘  ì¦ìƒ ì„ íƒ")
    col_s1, col_s2 = st.columns([2,1])
    with col_s1:
        symptom = st.selectbox("ì¦ìƒì„ í•˜ë‚˜ ì„ íƒí•˜ì„¸ìš”", [""] + list(DB.keys()), index=0)
    with col_s2:
        st.markdown("<p class='small'>ì¦ìƒì€ í•œ ë²ˆì— í•˜ë‚˜ì”© ì¶”ê°€ë©ë‹ˆë‹¤. ì—¬ëŸ¬ ì¦ìƒì„ ë¹„êµí•˜ë ¤ë©´ ì•„ë˜ì—ì„œ ë°˜ë³µí•´ **ì¶”ê°€í•˜ê¸°**ë¥¼ ëˆŒëŸ¬ ì£¼ì„¸ìš”.</p>", unsafe_allow_html=True)
    st.markdown("</div>", unsafe_allow_html=True)

# â”€â”€ ìŠ¤í… 2: í‘œì‹œí•  í•­ëª© ê³ ë¥´ê¸°(í•˜ë‚˜í•˜ë‚˜ ì²´í¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.container():
    st.markdown("<div class='step'>", unsafe_allow_html=True)
    st.subheader("â‘¡ í‘œì‹œí•  ì •ë³´ ê³ ë¥´ê¸° (ì›í•˜ëŠ” ê²ƒë§Œ ì²´í¬)")
    c1, c2, c3 = st.columns(3)
    with c1:
        f_drug = st.checkbox("ğŸ’Š ì•½", value=True)
        f_side = st.checkbox("âš ï¸ ë¶€ì‘ìš©", value=True)
    with c2:
        f_care = st.checkbox("ğŸ“ ìƒí™œ ê´€ë¦¬ë²•", value=True)
        f_time = st.checkbox("ğŸ•’ ë³µìš© ì‹œê°„", value=True)
    with c3:
        f_warn = st.checkbox("â— ì£¼ì˜ì‚¬í•­", value=True)
        f_tip  = st.checkbox("ğŸ’¡ ë³µìš© íŒ", value=True)
    st.markdown("</div>", unsafe_allow_html=True)

# â”€â”€ ìŠ¤í… 3: ì¶”ê°€í•˜ê¸°(ğŸ’Š íŒ ì• ë‹ˆë©”ì´ì…˜) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
emoji_slot = st.empty()
st.markdown("<hr class='hr'/>", unsafe_allow_html=True)
col_add, col_clear = st.columns([1,1])

with col_add:
    if st.button("â• ì„ íƒ ë‚´ìš© ì¹´ë“œë¡œ ì¶”ê°€í•˜ê¸°", use_container_width=True):
        if not symptom:
            st.warning("ì¦ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.")
        elif not any([f_drug, f_side, f_care, f_time, f_warn, f_tip]):
            st.warning("í‘œì‹œí•  í•­ëª©ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.")
        else:
            # ğŸ’Š íŒ
            emoji_slot.markdown("<div class='emoji'>ğŸ’Š</div>", unsafe_allow_html=True)
            time.sleep(0.5)
            emoji_slot.empty()

            item = {"ì¦ìƒ": symptom, "í‘œì‹œ": []}
            if f_drug: item["í‘œì‹œ"].append(("ğŸ’Š ì¶”ì²œ ì•½", DB[symptom]["ì•½"]))
            if f_side: item["í‘œì‹œ"].append(("âš ï¸ ë¶€ì‘ìš©", DB[symptom]["ë¶€ì‘ìš©"]))
            if f_care: item["í‘œì‹œ"].append(("ğŸ“ ìƒí™œ ê´€ë¦¬ë²•", DB[symptom]["ê´€ë¦¬ë²•"]))
            if f_time: item["í‘œì‹œ"].append(("ğŸ•’ ë³µìš© ì‹œê°„", DB[symptom]["ë³µìš©ì‹œê°„"]))
            if f_warn: item["í‘œì‹œ"].append(("â— ì£¼ì˜ì‚¬í•­", DB[symptom]["ì£¼ì˜ì‚¬í•­"]))
            if f_tip:  item["í‘œì‹œ"].append(("ğŸ’¡ ë³µìš© íŒ", DB[symptom]["ë³µìš©íŒ"]))
            st.session_state.results.append(item)
            st.success(f"'{symptom}' ì¹´ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!")

with col_clear:
    if st.button("ğŸ—‘ï¸ ì „ì²´ ì¹´ë“œ ì§€ìš°ê¸°", use_container_width=True, type="secondary"):
        st.session_state.results.clear()
        st.info("ëª¨ë“  ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")

# â”€â”€ ì„ íƒëœ ì¹´ë“œ ëª©ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.markdown("### ğŸ“‹ ì„ íƒëœ ì¹´ë“œ")
if not st.session_state.results:
    st.write("ì•„ì§ ì¶”ê°€ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¦ìƒê³¼ í•­ëª©ì„ ì„ íƒí•œ ë’¤ **â• ì¶”ê°€í•˜ê¸°**ë¥¼ ëˆŒëŸ¬ ë³´ì„¸ìš”.")
else:
    for idx, item in enumerate(st.session_state.results):
        with st.container():
            st.markdown("<div class='card'>", unsafe_allow_html=True)
            top = st.columns([5,1])
            with top[0]:
                st.markdown(f"#### <span class='highlight'>{item['ì¦ìƒ']}</span>", unsafe_allow_html=True)
            with top[1]:
                if st.button("ì‚­ì œ", key=f"del_{idx}"):
                    del st.session_state.results[idx]
                    st.experimental_rerun()

            st.markdown("<hr class='hr'/>", unsafe_allow_html=True)
            for label, value in item["í‘œì‹œ"]:
                st.markdown(f"**{label}**: {value}")
            st.markdown("</div>", unsafe_allow_html=True)
